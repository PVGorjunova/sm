package ru.kpfu.icmit.clientsm;
import java.util.ArrayList;
import com.google.gson.Gson;

public class Login {
	public static ServerResponse sendLoginInfo(String login, String password){

        System.out.println("Start login"+login);
        //Формирование JSON объекта который будет отправлен на сервер
        String message = "{\"login\":\""+login+"\",\"password\":\""+password+"\"}";

        HTTPSender sender = new HTTPSender("127.0.0.1", "3128");
        //Отправляем сообщение message на сервер с указанием ресурса "/reguser" который должен обработать наше сообщение
        ServerResponse resp = sender.sendMessage(message, "/login");

        System.out.println("Response code: "+resp.responseCode);
        // Возвращаем ответ сервера для дальнейшего анализа
        return resp;
    }
	public static ArrayList<Abonent> getAbonentList(String token){
        System.out.println("Request abonent list");
        String message = "{\"token\":\""+token+"\"}";
        HTTPSender sender = new HTTPSender("127.0.0.1", "3128");
        ServerResponse resp = sender.sendMessage(message, "/getusers");
        if (resp.responseCode!=200) return null;

        Gson gson = new Gson();
        Abonents result = gson.fromJson(resp.content, Abonents.class);
        return result.usrlist;
    }

    /** Тест */
    public static void main(String[] args ){
        Gson gson = new Gson();
        // Пример сообщения, которое может прийти от сервер
        String msg = "{\"usrlist\":[{\"id\":\"1\", \"name\":\"User1\"},{\"id\":\"2\", \"name\":\"User2\"},{\"id\":\"3\", \"name\":\"User3\"}]}";
        Abonents result = gson.fromJson(msg, Abonents.class);
        for(int i=0;i< result.usrlist.size();i++){
            System.out.println(result.usrlist.get(i).name);
        }
    }

    class Abonents{
        ArrayList<Abonent> usrlist;
    }
}
